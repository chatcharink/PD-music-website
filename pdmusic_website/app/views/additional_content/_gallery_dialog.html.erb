<!-- Modal -->
<div class="modal fade" id="addGallery" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="addGalleryLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <%= form_for "form_gallery" , url: update_additional_path(format: :json, menu: menu), method: :POST, html: { id: "form_gallery", class: "w-100" } do |f| %>
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addGalleryLabel">Add Gallery</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-action="click->gallery#clearGallery"></button>
            </div>
            <div class="modal-body">
                <div class="div-cover-content">
                    <div class="mb-3">
                        <label for="title" class="form-label">Gallery name :</label>
                        <%= f.text_field :title, value: content.title, class: "form-control", id: "title" %>
                    </div>
                    <div class="row px-3 mb-3">
                        <label for="upload-content-image-btn" class="form-label ps-0">Cover Image :</label>
                        <% source = content.image.attached? ? url_for(content.image) : "" %>
                        <% if source.blank? %>
                            <div class="col-6 div-no-picture rounded-3" id="div-no-image-content">
                                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-camera-fill" viewBox="0 0 16 16">
                                    <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                                    <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"/>
                                </svg>
                            </div>
                            <div class="col-6 show-content-image" id="div-content-image" style="display: none;">
                                <div class="div-show-content-image">
                                    <img id="content-image" class="w-100" src="<%= source %>" style="object-fit: cover;"/>
                                </div>
                            </div>
                        <% else %>
                            <div class="col-6 div-no-picture rounded-3" id="div-no-image-content" style="display: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-camera-fill" viewBox="0 0 16 16">
                                    <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                                    <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"/>
                                </svg>
                            </div>
                            <div class="col-6 show-content-image" id="div-content-image">
                                <div class="div-show-content-image">
                                    <img id="content-image" class="w-100" src="<%= source %>" style="object-fit: cover;"/>
                                </div>
                            </div>
                        <% end %>
                        <div class="col-6 input-file">
                            <%= f.file_field :image, accept: ".png, .jpg, .jpeg", data: { action: "change->gallery#uploadPicture" }, class: "upload-content-image-btn", id: "upload-content-image-btn"  %>
                            <%= f.hidden_field :is_image_update, value: "false", id: "is-update-image" %>
                        </div>
                    </div>
                    
                    <hr class="w-90 m-auto">
                    <div class="my-3">
                        <h5>Pictures</h5>
                    </div>
                    <div class="d-flex row row-cols-1 row-cols-md-4 g-4" id="gallery-grid">
                        <% arr_gallery = [] %>
                        <% if gallery.present? %>
                            <% gallery.each_with_index do |g, index| %>
                                <div class="col-auto col-preview-image" id="div-preview-image-<%= index + 1 %>">
                                    <div class="div-preview-image position-relative my-3" style="width: 150px;">
                                        <% source = g.image.attached? ? url_for(g.image) : "" %>
                                        <img id="preview-image-<%= index + 1 %>" class="w-100" src="<%= source %>" style="object-fit: cover;"/>
                                        <span class="position-absolute top-0 start-100 translate-middle btn-primary rounded-circle" data-action="click->gallery#deletePicture" data-gallery-number-param="<%= index + 1 %>" data-gallery-id-param="<%= g.id %>" style="padding: 2px 5px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></span>
                                    </div>
                                </div>
                                <% arr_gallery << g.id %>
                            <% end %>
                        <% end %>
                        <% length = gallery.length > 0 ? gallery.length+1 : 1 %>
                        <div class="col-auto" style="display: none;" id="default-preview-image">
                            <div class="div-preview-image position-relative my-3" style="width: 150px;">
                                <img id="preview-image" class="w-100" src="" style="object-fit: cover;"/>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="rounded-3 text-center align-content-center my-3" style="width: 150px; height: 150px;" id="div-add-picture-to-gallery">
                                <label for="add-pictue-to-gallery-<%= length %>" class="align-content-center w-100 h-100 upload-picture-gallery">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"/>
                                    </svg>
                                </label>
                            </div>
                        </div>
                        <div class="div-file-input">
                            <%= f.file_field "gallery[picture#{length}]", accept: ".png, .jpg, .jpeg", data: { action: "change->gallery#uploadPictureGallery", "gallery-number-param": "#{length}" }, class: "upload-picture-btn d-none", id: "add-pictue-to-gallery-#{length}" %>
                        </div>
                        <%= f.hidden_field :arr_gallery_id, value: arr_gallery.join(","), id: "arr-gallery-id" %>
                    </div>
                </div>
            </div>
            <%= f.hidden_field :update_id, value: content.id, id: "update-id" %>
            <div class="modal-footer">
                <%# <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> %>
                <%# <button type="button" class="btn btn-primary">Understood</button> %>
                <%= f.submit "Add", class: "btn btn-primary", id: "submit-content-btn" %>
            </div>
        </div>
        <% end %>
    </div>
</div>